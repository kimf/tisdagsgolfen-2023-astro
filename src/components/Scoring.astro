<div id="scoring">Startar golfbilarna....</div>

<script is:inline type="module">
  setTimeout(async () => {
    const scoringDiv = document.getElementById('scoring');

    // Function to get a cookie by name
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // Check if user is logged in (client-side)
    const activeUserId = getCookie('activeUserId');
    let activeSessionId;

    if (!activeUserId) {
      scoringDiv.innerHTML = '<a href="/login">LOGGA IN</a>';
    } else {
      // If user is logged in, fetch the user's active scoring session (client-side)
      let activeSession = localStorage.getItem('activeSession');
      if (!activeSession) {
        // If no active session, check with the server if there is an active session for the user
        try {
          const response = await fetch('/api/activesession.json');
          const data = await response.json();
          if (data) {
            localStorage.setItem('activeSession', JSON.stringify(data));
            activeSessionId = data.id;
          } else {
            scoringDiv.innerHTML = '<a href="/newsession">Starta ny runda</a>';
          }
        } catch (error) {
          console.error('Error fetching active session:', error);
          scoringDiv.innerHTML = 'Error fetching active session.';
        }
      } else {
        activeSessionId = JSON.parse(activeSession).id;
      }

      if (activeSessionId) {
        scoringDiv.innerHTML = `<a href="/scoring/${activeSessionId}">Fortsätt pågående runda</a>`;
      }
    }
  }, 550);
</script>
